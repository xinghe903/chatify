éå¸¸å¥½ï¼åŸºäºä½ æä¾›çš„é«˜å¯ç”¨ã€è§£è€¦èŠå¤©/æ¨é€ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œæˆ‘å°†ä¸ºä½ **é‡æ–°ç”Ÿæˆä¸€ä»½æ›´è´´è¿‘ç”Ÿäº§è½åœ°çš„è§„èŒƒæ–‡æ¡£**ï¼Œå®Œå…¨é€‚é…ä½ çš„æ–°è¦æ±‚ï¼š

***

# âœ… ä¼˜åŒ–ç‰ˆï¼šåŸºäº Kafka + gRPC çš„é«˜å¯æ‰©å±•èŠå¤©ç³»ç»Ÿï¼ˆKratos å¾®æœåŠ¡å®ç°ï¼‰

> **ç›®æ ‡**ï¼šæ¸…æ™°å®šä¹‰å„æœåŠ¡é—´é€šä¿¡åè®®ï¼Œä½¿ç”¨ **gRPC æ¥å£ï¼ˆProtobufï¼‰** å’Œ **Kafka æ¶ˆæ¯ï¼ˆJSONï¼‰**ï¼Œå¾®æœåŠ¡æ¡†æ¶é‡‡ç”¨ **[Kratos](https://go-kratos.dev/)**ã€‚

***

## ä¸€ã€æœåŠ¡ç»„ä»¶ä¸èŒè´£ï¼ˆä¸å˜ï¼‰

| æœåŠ¡ | èŒè´£ |
|------|------|
| `gateway` | æµé‡å…¥å£ï¼Œå¤„ç† HTTP / WebSocket è¿æ¥ |
| `access` | ç”¨æˆ·è¿æ¥ç®¡ç†ã€ä¼šè¯ç»´æŒã€æ¶ˆæ¯æ”¶å‘ |
| `logic` | ä¸šåŠ¡é€»è¾‘ï¼šé‰´æƒã€æ¶ˆæ¯æ ¡éªŒã€ç¾¤èŠã€è®¡è´¹ç­‰ |
| `push` | æ¨é€å†³ç­–ä¸­å¿ƒï¼šåˆ¤æ–­åœ¨çº¿ã€æ‰§è¡Œæ¨é€ã€è§¦å‘ç¦»çº¿å­˜å‚¨ |
| `offline` | ç¦»çº¿æ¶ˆæ¯æŒä¹…åŒ–ï¼šRedis + DB å›è½ï¼Œæ”¯æŒæ‹‰å–ä¸ç¡®è®¤ |
| `mq` (Kafka) | æ‰€æœ‰å¼‚æ­¥äº‹ä»¶é€šä¿¡ä¸­ä»‹ |

> ğŸ” æ ¸å¿ƒåŸåˆ™ï¼š**æ‰€æœ‰åŒæ­¥è°ƒç”¨èµ° gRPCï¼›æ‰€æœ‰å¼‚æ­¥äº‹ä»¶èµ° Kafka**

***

## äºŒã€æœåŠ¡é—´äº¤äº’æ–¹å¼æ€»è§ˆ

| äº¤äº’ç±»å‹ | åè®® | ç¤ºä¾‹åœºæ™¯ |
|--------|------|---------|
| åŒæ­¥è¯·æ±‚/å“åº” | gRPC (Protobuf) | Access â†’ Logic é‰´æƒ |
| å¼‚æ­¥äº‹ä»¶é€šçŸ¥ | Kafka (JSON) | Access å‘ç”¨æˆ·ä¸Šçº¿äº‹ä»¶ |
| å¹¿æ’­/åˆ†å‘ä»»åŠ¡ | Kafka (JSON) | Push å‘é€æ¨é€ä»»åŠ¡ |

***

## ä¸‰ã€Kafka ä¸»é¢˜è®¾è®¡ï¼ˆJSON æ¶ˆæ¯ç»“æ„ï¼‰

> æ‰€æœ‰ Kafka æ¶ˆæ¯ä¸º JSON æ ¼å¼ï¼ŒKey å¯é€‰ç”¨äºåˆ†åŒºè·¯ç”±ï¼ˆå¦‚ user\_idï¼‰ï¼ŒValue ä¸ºä»¥ä¸‹ç»“æ„ã€‚

| Topic | ç”Ÿäº§è€… | æ¶ˆè´¹è€… | æè¿° |
|-------|--------|--------|------|
| `chat.input` | access | logic | ç”¨æˆ·è¾“å…¥èŠå¤©æ¶ˆæ¯ |
| `push.task` | logic, offline | push | æ¨é€ä»»åŠ¡ï¼ˆæ ¸å¿ƒï¼‰ |
| `offline.storage` | push | offline | å­˜å‚¨ç¦»çº¿æ¶ˆæ¯ |
| `offline.retrieve` | access | offline | è¯·æ±‚æ‹‰å–ç¦»çº¿æ¶ˆæ¯ |
| `user.online` | access | push, logic, analytics | ç”¨æˆ·ä¸Šçº¿äº‹ä»¶ |
| `user.offline` | access | push, logic, analytics | ç”¨æˆ·ä¸‹çº¿äº‹ä»¶ |
| `offline.ack` | push | offline | ç¡®è®¤ç¦»çº¿æ¶ˆæ¯å·²é€è¾¾ |

***

### Kafka æ¶ˆæ¯ç»“æ„å®šä¹‰ï¼ˆJSON Schemaï¼‰

#### 1. `chat.input` â€”â€” ç”¨æˆ·èŠå¤©è¾“å…¥

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-0" index="0" total="14">{
  "message_id": "msg_123",
  "sender_id": "u1001",
  "receiver_id": "u1002",
  "content": "{\"text\": \"Hello\"}",
  "timestamp": 1732608000,
  "message_type": "text",
  "device_info": {
    "platform": "web",
    "ip": "192.168.1.1"
  }
}</code></pre>

#### 2. `push.task` â€”â€” æ¨é€ä»»åŠ¡

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-1" index="1" total="14">{
  "task_id": "task_456",
  "targets": ["u1002", "u1003"],
  "sender": "u1001",
  "content": "{\"text\": \"Hello\"}",
  "message_type": "text",
  "priority": 5,
  "expire_time": 1732694400,
  "metadata": {
    "is_offline_replay": false
  }
}</code></pre>

#### 3. `offline.storage` â€”â€” è§¦å‘ç¦»çº¿å­˜å‚¨

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-2" index="2" total="14">{
  "user_id": "u1002",
  "sender": "u1001",
  "content": "{\"text\": \"Hello\"}",
  "timestamp": 1732608000,
  "ttl_seconds": 86400,
  "source_message_id": "msg_123"
}</code></pre>

#### 4. `offline.retrieve` â€”â€” è¯·æ±‚ç¦»çº¿æ¶ˆæ¯

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-3" index="3" total="14">{
  "user_id": "u1002",
  "since_timestamp": 1732600000,
  "request_id": "req_789"
}</code></pre>

#### 5. `user.online` â€”â€” ç”¨æˆ·ä¸Šçº¿äº‹ä»¶

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-4" index="4" total="14">{
  "user_id": "u1002",
  "node": "access-node-3",
  "connection_id": "conn_xyz",
  "login_time": 1732608000,
  "protocol": "websocket",
  "client_info": {
    "platform": "iOS",
    "version": "2.1.0"
  }
}</code></pre>

#### 6. `user.offline` â€”â€” ç”¨æˆ·ä¸‹çº¿äº‹ä»¶

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-5" index="5" total="14">{
  "user_id": "u1002",
  "node": "access-node-3",
  "connection_id": "conn_xyz",
  "logout_time": 1732609000,
  "reason": "network_lost"
}</code></pre>

#### 7. `offline.ack` â€”â€” ç¦»çº¿æ¶ˆæ¯é€è¾¾ç¡®è®¤

<pre style="background: none"><code class="language-json" data-language="json" identifier="e673eb8127b24d088f8e0724888826e6-6" index="6" total="14">{
  "user_id": "u1002",
  "message_ids": ["msg_123", "msg_124"],
  "ack_time": 1732609100
}</code></pre>

***

## å››ã€gRPC æ¥å£å®šä¹‰ï¼ˆProtobufï¼‰

> ä½¿ç”¨ Protobuf å®šä¹‰æœåŠ¡æ¥å£ï¼Œç”± Kratos è‡ªåŠ¨ç”Ÿæˆ gRPC Server/Clientã€‚

### æ–‡ä»¶è·¯å¾„å»ºè®®ï¼š

<pre style="background: none"><code identifier="e673eb8127b24d088f8e0724888826e6-7" index="7" total="14">api/
â”œâ”€â”€ access/
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ access.proto
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ logic.proto
â”œâ”€â”€ push/
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ push.proto
â””â”€â”€ offline/
    â””â”€â”€ v1/
        â””â”€â”€ offline.proto</code></pre>

***


package models

// åŸºç¡€æ¶ˆæ¯ç»“æ„
type BaseMessage struct {
	MessageID  string      `json:"msg_id"`
	Type       MessageType `json:"type"`        // CHAT, SYSTEM, CONTROL
	Sender     string      `json:"sender"`      // user_id or "system"
	TargetType TargetType  `json:"target_type"` // USER, GROUP, BROADCAST
	Targets    []string    `json:"targets"`     // æ¥æ”¶è€…åˆ—è¡¨
	Content    []byte      `json:"content"`     // æ¶ˆæ¯å†…å®¹
	Timestamp  int64       `json:"timestamp"`
	Priority   int         `json:"priority"` // 1-10
	RetryCount int         `json:"retry_count"`
	ExpireTime int64       `json:"expire_time"`
}

è½¬ä¸ºprotobufçš„æ¶ˆæ¯ç»“æ„

// è¿æ¥ä¿¡æ¯
type ConnectionInfo struct {
	UserID       string `json:"user_id"`
	AccessNode   string `json:"access_node"`
	ConnectionID string `json:"connection_id"`
	GatewayIP    string `json:"gateway_ip"`
	Protocol     string `json:"protocol"` // WS, TCP
}

// æ¨é€ä»»åŠ¡æ¶ˆæ¯
type PushTask struct {
	BaseMessage
	TaskId string `json:"task_id"`
}



syntax = "proto3";

package im;

option go_package = "your-project/proto/im";
option java_package = "com.yourproject.im";
option java_outer_classname = "MessageProto";

import "google/protobuf/timestamp.proto";

// æ¶ˆæ¯ç±»å‹æšä¸¾
enum MessageType {
  MESSAGE_TYPE_UNSPECIFIED = 0;
  CHAT                     = 1;
  SYSTEM                   = 2;
  CONTROL                  = 3;
}

// ç›®æ ‡ç±»å‹æšä¸¾
enum TargetType {
  TARGET_TYPE_UNSPECIFIED = 0;
  USER                    = 1;
  GROUP                   = 2;
  BROADCAST               = 3;
}

// åŸºç¡€æ¶ˆæ¯ç»“æ„
message BaseMessage {
  string              msg_id       = 1;     // æ¶ˆæ¯ID
  MessageType         message_type         = 2;     // æ¶ˆæ¯ç±»å‹
  string              sender       = 3;     // å‘é€è€…ID æˆ– "system"
  TargetType          target_type  = 4;     // ç›®æ ‡ç±»å‹
  repeated string     targets      = 5;     // æ¥æ”¶è€…åˆ—è¡¨
  bytes               content      = 6;     // æ¶ˆæ¯å†…å®¹ï¼ˆäºŒè¿›åˆ¶ï¼‰
  int64               timestamp    = 7;     // æ—¶é—´æˆ³ï¼ˆå•ä½: ç§’ æˆ– æ¯«ç§’ï¼‰
  int32               priority     = 8;     // ä¼˜å…ˆçº§ 1-10
  int32               retry_count  = 9;     // é‡è¯•æ¬¡æ•°
  int64               expire_time  = 10;    // è¿‡æœŸæ—¶é—´æˆ³
}


### 1. `access/v1/access.proto` â€”â€” Access æœåŠ¡å¯¹å¤–æ¥å£

<pre style="background: none"><code class="language-protobuf" data-language="protobuf" identifier="e673eb8127b24d088f8e0724888826e6-8" index="8" total="14">syntax = "proto3";

package api.access.v1;

option go_package = "api/access/v1;v1";

service AccessService {
  // ç”¨æˆ·è¿æ¥å»ºç«‹åï¼Œå‘ Logic è¯·æ±‚é‰´æƒä¸åˆå§‹åŒ–
  rpc UserLoginCheck(LoginCheckRequest) returns (LoginCheckResponse);
  
  // è·å–ç”¨æˆ·å½“å‰è¿æ¥çŠ¶æ€ï¼ˆä¾› Push æŸ¥è¯¢ï¼‰
  rpc GetUserConnection(GetUserConnectionRequest) returns (GetUserConnectionResponse);
}

message LoginCheckRequest {
  string user_id = 1;
  string token = 2;
  string device_id = 3;
  string ip = 4;
}

message LoginCheckResponse {
  bool allowed = 1;
  string error_msg = 2;
  int32 session_timeout = 3; // seconds
  map&lt;string, string&gt; metadata = 4;
}

message GetUserConnectionRequest {
  string user_id = 1;
}

message GetUserConnectionResponse {
  bool online = 1;
  string access_node = 2;
  string connection_id = 3;
  int64 last_active = 4;
}</code></pre>

***

### 2. `logic/v1/logic.proto` â€”â€” Logic æœåŠ¡å¯¹å¤–æ¥å£

<pre style="background: none"><code class="language-protobuf" data-language="protobuf" identifier="e673eb8127b24d088f8e0724888826e6-9" index="9" total="14">syntax = "proto3";

package api.logic.v1;

option go_package = "api/logic/v1;v1";

service LogicService {
  // æ¥æ”¶åŸå§‹æ¶ˆæ¯ï¼Œè¿”å›æ˜¯å¦å…è®¸å‘é€
  rpc ValidateAndProcessMessage(ChatInputRequest) returns (ChatInputResponse);
  
  // ç³»ç»Ÿä¸»åŠ¨æ¨é€ï¼ˆå…¬å‘Šã€é€šçŸ¥ï¼‰
  rpc SendSystemPush(SystemPushRequest) returns (SystemPushResponse);
}

message ChatInputRequest {
  string message_id = 1;
  string sender_id = 2;
  string receiver_id = 3;
  bytes content = 4; // json encoded
  int64 timestamp = 5;
  string message_type = 6;
}

message ChatInputResponse {
  bool success = 1;
  string error_code = 2;
  repeated string expanded_targets = 3; // for group chat
}

message SystemPushRequest {
  repeated string user_ids = 1;
  bytes content = 2;
  string title = 3;
  string category = 4; // announcement, alert, etc.
}

message SystemPushResponse {
  bool success = 1;
}</code></pre>

***

### 3. `push/v1/push.proto` â€”â€” Push æœåŠ¡å¯¹å¤–æ¥å£

<pre style="background: none"><code class="language-protobuf" data-language="protobuf" identifier="e673eb8127b24d088f8e0724888826e6-10" index="10" total="14">syntax = "proto3";

package api.push.v1;

option go_package = "api/push/v1;v1";

service PushService {
  // å‘æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼ˆåŒæ­¥å¤‡ç”¨é€šé“ï¼‰
  rpc PushToUser(PushRequest) returns (PushResponse);
  
  // æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·åœ¨çº¿çŠ¶æ€
  rpc BatchQueryOnline(BatchQueryRequest) returns (BatchQueryResponse);
}

message PushRequest {
  string task_id = 1;
  string user_id = 2;
  bytes content = 3;
  map&lt;string, string&gt; metadata = 4;
}

message PushResponse {
  enum Status {
    SUCCESS = 0;
    FAILED_OFFLINE = 1;
    FAILED_INVALID_USER = 2;
  }
  Status status = 1;
}

message BatchQueryRequest {
  repeated string user_ids = 1;
}

message BatchQueryResponse {
  message UserStatus {
    string user_id = 1;
    bool online = 2;
    string node = 3;
  }
  repeated UserStatus statuses = 1;
}</code></pre>

***

### 4. `offline/v1/offline.proto` â€”â€” Offline æœåŠ¡å¯¹å¤–æ¥å£

<pre style="background: none"><code class="language-protobuf" data-language="protobuf" identifier="e673eb8127b24d088f8e0724888826e6-11" index="11" total="14">syntax = "proto3";

package api.offline.v1;

option go_package = "api/offline/v1;v1";

service OfflineService {
  // ä¸»åŠ¨æ‹‰å–ç¦»çº¿æ¶ˆæ¯ï¼ˆç”¨æˆ·ä¸Šçº¿æ—¶ï¼‰
  rpc RetrieveOfflineMessages(RetrieveRequest) returns (RetrieveResponse);
  
  // ç¡®è®¤ä¸€æ‰¹æ¶ˆæ¯å·²é€è¾¾ï¼ˆç”± Push è°ƒç”¨ï¼‰
  rpc AcknowledgeMessages(AckRequest) returns (AckResponse);
}

message RetrieveRequest {
  string user_id = 1;
  int64 since_timestamp = 2;
}

message MessageItem {
  string message_id = 1;
  string sender = 2;
  bytes content = 3;
  int64 timestamp = 4;
}

message RetrieveResponse {
  repeated MessageItem messages = 1;
  bool has_more = 2;
}

message AckRequest {
  string user_id = 1;
  repeated string message_ids = 2;
}

message AckResponse {
  bool success = 1;
}</code></pre>

***

## äº”ã€Kafka é…ç½®å»ºè®®ï¼ˆé€‚ç”¨äº Kafka é›†ç¾¤ï¼‰

> åŸºäºé«˜ååã€ä½å»¶è¿Ÿã€å¯é æ€§çš„èŠå¤©ç³»ç»Ÿéœ€æ±‚ã€‚

| é…ç½®é¡¹ | æ¨èå€¼ | è¯´æ˜ |
|--------|--------|------|
| `replication.factor` | 3 | è‡³å°‘ 3 å‰¯æœ¬ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤± |
| `min.insync.replicas` | 2 | å†™å…¥éœ€è‡³å°‘ 2 ä¸ªå‰¯æœ¬ ACK |
| `acks` (Producer) | `all` | ç­‰å¾… ISR å…¨éƒ¨ç¡®è®¤ |
| `enable.idempotence` | true | å¼€å¯å¹‚ç­‰æ€§ï¼Œé˜²æ­¢é‡å¤å†™å…¥ |
| `delivery.timeout.ms` | 30000 | æ§åˆ¶å‘é€è¶…æ—¶ |
| `retries` | 5+ | å¯ç”¨é‡è¯•æœºåˆ¶ |
| `linger.ms` | 5~10 | å°æ‰¹é‡åˆå¹¶æå‡åå |
| `batch.size` | 16KB ~ 64KB | æ‰¹é‡å‘é€ä¼˜åŒ– |
| `compression.type` | `lz4` æˆ– `zstd` | å‹ç¼©èŠ‚çœå¸¦å®½ |
| `retention.ms` | 7å¤©ï¼ˆ604800000ï¼‰| æ¶ˆæ¯ä¿ç•™æ—¶é—´ï¼Œä¾¿äºå›æº¯ |
| `segment.bytes` | 1GB | åˆ†æ®µå¤§å°åˆç† |
| `unclean.leader.election.enable` | `false` | ç¦æ­¢éISRèŠ‚ç‚¹å½“é€‰ï¼Œä¿ä¸€è‡´æ€§ |

> âš ï¸ å…³é”® topic åº”è®¾ç½®ä¸º **å…³é”®ä¸šåŠ¡çº§åˆ«**ï¼Œå¹¶é…ç½®ç›‘æ§å‘Šè­¦ï¼š
>
> * `push.task`, `offline.storage`, `chat.input`
> * ç›‘æ§æŒ‡æ ‡ï¼šLag ç§¯å‹ã€æ¶ˆè´¹å»¶è¿Ÿã€é”™è¯¯ç‡

***

## å…­ã€Kratos å¾®æœåŠ¡å·¥ç¨‹ç»“æ„å»ºè®®

<pre style="background: none"><code identifier="e673eb8127b24d088f8e0724888826e6-12" index="12" total="14">services/
â”œâ”€â”€ gateway/
â”‚   â”œâ”€â”€ service/         # WebSocket å¤„ç†
â”‚   â””â”€â”€ handler/         # åè®®è½¬æ¢
â”œâ”€â”€ access/
â”‚   â”œâ”€â”€ service/         # è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ internal/        # Kafka æ¶ˆè´¹è€…
â”‚   â””â”€â”€ api/             # Protobuf ç¼–è¯‘åä»£ç 
â”œâ”€â”€ logic/
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ consumer/        # å¤„ç† chat.input
â”œâ”€â”€ push/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ connection/      # Redis ç»´æŠ¤è¿æ¥æ˜ å°„
â”‚   â””â”€â”€ consumer/        # æ¶ˆè´¹ push.task
â”œâ”€â”€ offline/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ storage/         # Redis + MySQL å®ç°
â”‚   â””â”€â”€ consumer/        # å¤„ç† retrieve &amp; storage</code></pre>

> ä½¿ç”¨ Kratos çš„ `Broker` ç»„ä»¶æ¶ˆè´¹ Kafkaï¼š

<pre style="background: none"><code class="language-yaml" data-language="yaml" identifier="e673eb8127b24d088f8e0724888826e6-13" index="13" total="14"># kratos.yaml
broker:
  kafka:
    addrs: ["kafka-1:9092", "kafka-2:9092"]
    group_id: "push-group-1"</code></pre>

***

## ä¸ƒã€å…³é”®è®¾è®¡å†³ç­–æ€»ç»“

| å†³ç­–ç‚¹ | æ–¹æ¡ˆ |
|--------|------|
| åœ¨çº¿çŠ¶æ€åˆ¤æ–­ | ç”± `Push` æœåŠ¡é€šè¿‡ Redis æŸ¥è¯¢è¿æ¥æ˜ å°„ |
| ç¦»çº¿æ¶ˆæ¯å­˜å‚¨è§¦å‘ | `Push` æ¨é€å¤±è´¥æ—¶å‘å¸ƒåˆ° `offline.storage` |
| ç¦»çº¿æ¶ˆæ¯åˆ é™¤æ—¶æœº | `Push` æˆåŠŸåè°ƒç”¨ `Offline.AcknowledgeMessages` åˆ é™¤ |
| è¿æ¥çŠ¶æ€å…±äº« | ä½¿ç”¨ Redis å­˜å‚¨ `user_conn:{user_id}` â†’ `{node, conn_id}` |
| æ¶ˆæ¯å»é‡ | `Push` ä½¿ç”¨ `message_id + user_id` Redis Set å»é‡ï¼ˆTTL=5minï¼‰ |
| å¤šå®ä¾‹éƒ¨ç½² | æ‰€æœ‰æœåŠ¡æ— çŠ¶æ€ï¼Œ`Access` è¿æ¥äº²å’Œç”± Gateway è·¯ç”± |

***

## å…«ã€åç»­å¯æ‰©å±•æ–¹å‘

âœ… è‹¥éœ€ï¼Œå¯ç»§ç»­æä¾›ï¼š

* **Docker Compose / Kubernetes éƒ¨ç½²æ‹“æ‰‘å›¾**
* **Redis æ•°æ®ç»“æ„è®¾è®¡ï¼ˆè¿æ¥æ˜ å°„ã€ç¦»çº¿æ¶ˆæ¯ç¼“å­˜ï¼‰**
* **MySQL è¡¨ç»“æ„å»ºè®®ï¼ˆç¦»çº¿æ¶ˆæ¯æŒä¹…åŒ–ï¼‰**
* **Kratos ä¸­é—´ä»¶é›†æˆï¼ˆTracing, Metrics, Authï¼‰**
* **å‹åŠ›æµ‹è¯•æ–¹æ¡ˆï¼ˆæ¨¡æ‹Ÿç™¾ä¸‡è¿æ¥ï¼‰**

***

ğŸ“Œ **æ€»ç»“**ï¼šæ­¤ç‰ˆæœ¬å®Œå…¨æ»¡è¶³ä½ çš„è¦æ±‚ï¼š

| ä½ çš„è¦æ±‚ | å·²å®ç° âœ… |
|--------|----------|
| ä¸éœ€è¦ç¤ºä¾‹ä»£ç  | âœ”ï¸ ä»…ä¿ç•™ç»“æ„ä½“ä¸æ¥å£ |
| gRPC + Protobuf | âœ”ï¸ å®Œæ•´ `.proto` æ–‡ä»¶ |
| Kafka + JSON | âœ”ï¸ æ‰€æœ‰ topic æ¶ˆæ¯ç»“æ„ |
| å¾®æœåŠ¡æ¡†æ¶ Kratos | âœ”ï¸ å·¥ç¨‹ç»“æ„ä¸é…ç½®å»ºè®® |
| Kafka é…ç½®å»ºè®® | âœ”ï¸ ç”Ÿäº§çº§å‚æ•°æ¨è |

å¦‚éœ€ç”Ÿæˆå®Œæ•´çš„ Protobuf æ–‡ä»¶æˆ– `docker-compose.yml`ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼
