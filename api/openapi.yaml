# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/cmd/protoc-gen-openapi

openapi: 3.0.3
info:
    title: ""
    version: 0.0.1
paths:
    /chatify/auth/v1/login:
        post:
            tags:
                - AuthService
            description: 2. 登录用户
            operationId: AuthService_Login
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/auth.v1.LoginRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.LoginResponse'
    /chatify/auth/v1/logout:
        post:
            tags:
                - AuthService
            description: 4. 登出用户（退出当前会话）
            operationId: AuthService_Logout
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/auth.v1.LogoutRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.LogoutResponse'
    /chatify/auth/v1/refreshToken:
        post:
            tags:
                - AuthService
            description: 5. 使用 refresh token 续签 access token
            operationId: AuthService_RefreshToken
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/auth.v1.RefreshTokenRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.RefreshTokenResponse'
    /chatify/auth/v1/register:
        post:
            tags:
                - AuthService
            description: 1. 注册用户
            operationId: AuthService_Register
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/auth.v1.RegisterRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.RegisterResponse'
    /chatify/auth/v1/revokeUser:
        post:
            tags:
                - AuthService
            description: 3. 注销用户（永久删除账户，作废所有 token）
            operationId: AuthService_RevokeUser
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/auth.v1.RevokeUserRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.RevokeUserResponse'
    /chatify/auth/v1/verifyToken:
        get:
            tags:
                - AuthService
            description: 6. 校验访问令牌
            operationId: AuthService_VerifyToken
            parameters:
                - name: accessToken
                  in: query
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/auth.v1.VerifyTokenResponse'
    /chatify/logic/v1/sendSystemPush:
        post:
            tags:
                - LogicService
            description: 系统主动推送（公告、通知）
            operationId: LogicService_SendSystemPush
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/logic.v1.SystemPushRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/logic.v1.SystemPushResponse'
    /chatify/offline/v1/AcknowledgeMessages:
        post:
            tags:
                - OfflineService
            description: 确认一批消息已送达（由 Push 调用）
            operationId: OfflineService_AcknowledgeMessages
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/offline.v1.AckRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/offline.v1.AckResponse'
    /chatify/offline/v1/ArchiveMessages:
        post:
            tags:
                - OfflineService
            description: 归档一批离线消息
            operationId: OfflineService_ArchiveMessages
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/offline.v1.ArchiveRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/offline.v1.ArchiveResponse'
    /chatify/offline/v1/RetrieveOfflineMessages:
        get:
            tags:
                - OfflineService
            description: 主动拉取离线消息（用户上线时）
            operationId: OfflineService_RetrieveOfflineMessages
            parameters:
                - name: userId
                  in: query
                  schema:
                    type: string
                - name: lastMessageId
                  in: query
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/offline.v1.RetrieveResponse'
components:
    schemas:
        auth.v1.LoginRequest:
            type: object
            properties:
                username:
                    type: string
                email:
                    type: string
                phone:
                    type: string
                password:
                    type: string
            description: 2. 登录
        auth.v1.LoginResponse:
            type: object
            properties:
                userId:
                    type: string
                username:
                    type: string
                accessToken:
                    type: string
                refreshToken:
                    type: string
                accessExpiresIn:
                    type: string
                refreshExpiresIn:
                    type: string
        auth.v1.LogoutRequest:
            type: object
            properties:
                userId:
                    type: string
                refreshToken:
                    type: string
            description: 4. 登出
        auth.v1.LogoutResponse:
            type: object
            properties: {}
        auth.v1.RefreshTokenRequest:
            type: object
            properties:
                refreshToken:
                    type: string
            description: 5. 续签 Token
        auth.v1.RefreshTokenResponse:
            type: object
            properties:
                accessToken:
                    type: string
                accessExpiresIn:
                    type: string
                newRefreshToken:
                    type: string
                refreshExpiresIn:
                    type: string
        auth.v1.RegisterRequest:
            type: object
            properties:
                username:
                    type: string
                email:
                    type: string
                password:
                    type: string
                phone:
                    type: string
            description: 1. 注册
        auth.v1.RegisterResponse:
            type: object
            properties:
                userId:
                    type: string
        auth.v1.RevokeUserRequest:
            type: object
            properties:
                userId:
                    type: string
                password:
                    type: string
                token:
                    type: string
            description: 3. 注销用户（永久删除账户）
        auth.v1.RevokeUserResponse:
            type: object
            properties: {}
        auth.v1.VerifyTokenResponse:
            type: object
            properties:
                username:
                    type: string
                userId:
                    type: string
                expiresAt:
                    type: string
        im.v1.BaseMessage:
            type: object
            properties:
                msgId:
                    type: string
                messageType:
                    type: integer
                    format: enum
                fromUserId:
                    type: string
                targetType:
                    type: integer
                    format: enum
                toUserId:
                    type: string
                content:
                    type: string
                    format: bytes
                timestamp:
                    type: string
                expireTime:
                    type: string
                contentId:
                    type: string
            description: 基础消息结构
        logic.v1.SystemPushRequest:
            type: object
            properties:
                contentId:
                    type: string
                content:
                    type: string
                    format: bytes
                timestamp:
                    type: string
                pushType:
                    type: integer
                    format: enum
                fromUserId:
                    type: string
                toUserIds:
                    type: array
                    items:
                        type: string
                expireTime:
                    type: string
        logic.v1.SystemPushResponse:
            type: object
            properties: {}
        offline.v1.AckRequest:
            type: object
            properties:
                userId:
                    type: string
                messageIds:
                    type: array
                    items:
                        type: string
        offline.v1.AckResponse:
            type: object
            properties: {}
        offline.v1.ArchiveRequest:
            type: object
            properties:
                taskId:
                    type: string
                message:
                    type: array
                    items:
                        $ref: '#/components/schemas/im.v1.BaseMessage'
        offline.v1.ArchiveResponse:
            type: object
            properties: {}
        offline.v1.RetrieveResponse:
            type: object
            properties:
                message:
                    type: array
                    items:
                        $ref: '#/components/schemas/im.v1.BaseMessage'
tags:
    - name: AuthService
      description: 认证服务
    - name: LogicService
    - name: OfflineService
